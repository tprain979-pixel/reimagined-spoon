# 可视化配置指南

## Tavily API 注册流程图

```
┌─────────────────────────────────────────────────────────┐
│  步骤 1: 访问 Tavily 官网                                │
│  https://tavily.com                                     │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  步骤 2: 点击 "Get Started" 或 "Sign Up"               │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  步骤 3: 选择注册方式                                    │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │ Google 账号  │  │ GitHub 账号  │  │  邮箱注册    │ │
│  │  （推荐）     │  │              │  │              │ │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘ │
└─────────┼──────────────────┼──────────────────┼─────────┘
          │                  │                  │
          └──────────────────┴──────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────┐
│  步骤 4: 授权登录                                        │
│  - Google: 选择账号 → 允许                              │
│  - GitHub: 授权应用                                     │
│  - Email: 验证邮箱                                      │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  步骤 5: 自动跳转到 Dashboard                           │
│  https://app.tavily.com                                │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  步骤 6: 复制 API Key                                   │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ Your API Key:                                   │   │
│  │ tvly-abc123def456ghi789...          📋 Copy    │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  免费配额: 1,000 次/月                                  │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  步骤 7: 填入 config.json                               │
│                                                         │
│  "tavily_api_key": "tvly-你复制的密钥"                  │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  步骤 8: 运行测试                                        │
│  python test_tavily.py                                 │
│                                                         │
│  ✅ API Key 有效！                                      │
│  ✅ 搜索成功，返回 X 条结果                             │
└─────────────────────────────────────────────────────────┘
```

---

## 飞书 Webhook 配置流程图

```
┌─────────────────────────────────────────────────────────┐
│  步骤 1: 打开飞书群聊                                    │
│  选择现有群或创建新群（推荐：物流预警群）                │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  步骤 2: 打开群设置                                      │
│  点击群名称或右上角 ⚙️ 图标                             │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  步骤 3: 进入群机器人管理                                │
│  群设置 → 群机器人 → 添加机器人                         │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  步骤 4: 选择机器人类型                                  │
│  选择 "自定义机器人" （不是其他预设机器人）              │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  步骤 5: 配置机器人信息                                  │
│  - 名称: 物流预警机器人                                 │
│  - 描述: 监控欧洲物流天气和新闻                          │
│  - 安全设置: 可留空                                     │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  步骤 6: 完成添加并复制 Webhook                         │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ Webhook URL:                                    │   │
│  │ https://open.feishu.cn/open-apis/bot/v2/        │   │
│  │ hook/xxxx-xxxx-xxxx-xxxx        📋 复制         │   │
│  └─────────────────────────────────────────────────┘   │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  步骤 7: 填入 config.json                               │
│                                                         │
│  "webhook_url": "https://open.feishu.cn/..."          │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  步骤 8: 运行测试                                        │
│  python test_feishu.py                                 │
│                                                         │
│  ✅ 测试成功！飞书推送功能正常工作                       │
│  飞书群聊收到测试消息 💬                                │
└─────────────────────────────────────────────────────────┘
```

---

## 完整系统架构图

```
                    ┌──────────────────┐
                    │   定时任务触发    │
                    │  (Cron/Schedule)  │
                    └────────┬─────────┘
                             │
              ┌──────────────┴──────────────┐
              │                             │
          每天 8:00                     每天 9:00
          天气检查                      新闻检查
              │                             │
              ▼                             ▼
    ┌─────────────────┐          ┌─────────────────┐
    │ weather_monitor │          │  news_monitor   │
    │      .py        │          │      .py        │
    └────────┬────────┘          └────────┬────────┘
             │                            │
             │  Tavily API                │  Tavily API
             │  搜索天气                   │  搜索新闻
             │                            │
             ▼                            ▼
    ┌─────────────────┐          ┌─────────────────┐
    │   Tavily API    │          │   Tavily API    │
    │   返回天气数据   │          │   返回新闻数据   │
    └────────┬────────┘          └────────┬────────┘
             │                            │
             │ 格式化报告                  │ 去重检查
             │                            │ (storage.py)
             │                            │
             ▼                            ▼
    ┌────────────────────────────────────────┐
    │         feishu_sender.py               │
    │     (飞书推送模块)                      │
    └────────────────┬───────────────────────┘
                     │
                     │ Webhook/Bot API
                     │
                     ▼
            ┌─────────────────┐
            │   飞书群聊      │
            │   接收消息      │
            └─────────────────┘
                     │
                     ▼
              📱 你收到通知
```

---

## 使用场景演示

### 场景 1：正常天气日

```
8:00 → 系统检查天气
     → 未发现重大预警
     → 推送消息：
       "暂无重大天气预警，物流运输正常"
     → 你查看飞书：放心了 ✅

9:00 → 系统检查新闻
     → 未发现新增事件
     → 不推送（保持安静）
     → 你继续工作 ✅
```

### 场景 2：极端天气日

```
8:00 → 系统检查天气
     → 发现德国暴风雨预警 ⚠️
     → 推送消息：
       "德国北部暴风雨预警，可能影响物流"
     → 你收到通知：提前调整计划 ✅

9:00 → 系统检查新闻
     → 发现汉堡港口因天气关闭 🚨
     → 推送消息：
       "汉堡港口关闭，运输受阻"
     → 你收到通知：联系客户说明情况 ✅
```

### 场景 3：罢工事件

```
8:00 → 天气正常，推送日常报告

9:00 → 系统检查新闻
     → 发现新增罢工消息 🚨
     → 推送消息：
       "法国运输工人罢工，预计持续3天"
     → 你收到通知：寻找替代路线 ✅

第二天 9:00 → 系统再次检查
            → 相同罢工消息（已记录）
            → 不推送（避免重复）✅
```

---

## 配置完成标准

当你完成配置后：

✅ **技术检查通过**
- `python check_config.py` 显示全部通过
- `python test_tavily.py` 返回搜索结果
- `python test_feishu.py` 飞书收到测试消息

✅ **功能测试通过**
- `python logistics_alert.py both` 成功执行
- 飞书群聊收到天气报告
- 飞书群聊收到新闻报告（如有新增）

✅ **定时任务设置**
- Cron 或任务计划程序已配置
- 日志目录已创建
- 首次定时执行成功

---

## 预估配置时间

- **Tavily 注册：** 3-5 分钟
- **飞书配置：** 2-3 分钟
- **测试验证：** 2-3 分钟
- **设置定时任务：** 2-3 分钟

**总计：** 10-15 分钟完成全部配置

---

## 立即开始

1️⃣ **运行检查：** `python check_config.py`

2️⃣ **按照提示完成缺失的配置**

3️⃣ **运行测试：** `python test_tavily.py` 和 `python test_feishu.py`

4️⃣ **执行首次检查：** `python logistics_alert.py both`

5️⃣ **设置定时任务，开始自动监控！**

---

🎉 **恭喜！** 配置完成后，系统将自动：
- 每天早上推送天气预警
- 有新增事件时推送物流新闻
- 自动去重，不重复推送
- 持续监控，保障物流畅通
